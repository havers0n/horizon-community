# –ê–Ω–∞–ª–∏–∑ WebSocket —Å–æ–±—ã—Ç–∏–π - –û—Ç—á–µ—Ç

## –ó–∞–¥–∞—á–∞ ‚Ññ3: –ê–Ω–∞–ª–∏–∑ WebSocket —Å–æ–±—ã—Ç–∏–π

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ WebSocket –≤ –ø—Ä–æ–µ–∫—Ç–µ

#### –ê–Ω–∞–ª–∏–∑ `server/websocket.ts`

**–¢–µ–∫—É—â–∏–µ —Å–æ–±—ã—Ç–∏—è –≤ –≤–∞—à–µ–º backend:**

1. **–ë–∞–∑–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è:**
   - `welcome` - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
   - `authenticated` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
   - `subscribed` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª—ã
   - `unsubscribed` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç–ø–∏—Å–∫–∏ –æ—Ç –∫–∞–Ω–∞–ª–æ–≤
   - `ping/pong` - heartbeat –º–µ—Ö–∞–Ω–∏–∑–º
   - `heartbeat` - –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
   - `error` - —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

2. **CAD-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è:**
   - `unit_status_update` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —é–Ω–∏—Ç–∞
   - `unit_location_update` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è —é–Ω–∏—Ç–∞
   - `new_call` - –Ω–æ–≤—ã–π –≤—ã–∑–æ–≤ 911
   - `call_status_update` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤—ã–∑–æ–≤–∞
   - `panic_alert` - —Å–∏–≥–Ω–∞–ª –ø–∞–Ω–∏–∫–∏ –æ—Ç —é–Ω–∏—Ç–∞
   - `bolo_alert` - BOLO (Be On Look Out) –æ–ø–æ–≤–µ—â–µ–Ω–∏—è

3. **–ö–∞–Ω–∞–ª—ã –ø–æ–¥–ø–∏—Å–∫–∏:**
   - `units` - —Å–æ–±—ã—Ç–∏—è —é–Ω–∏—Ç–æ–≤
   - `calls` - —Å–æ–±—ã—Ç–∏—è –≤—ã–∑–æ–≤–æ–≤
   - `alerts` - –æ–ø–æ–≤–µ—â–µ–Ω–∏—è
   - `all` - –≤—Å–µ —Å–æ–±—ã—Ç–∏—è

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å SnailyCAD Socket.IO —Å–æ–±—ã—Ç–∏—è–º–∏

#### –°–æ–±—ã—Ç–∏—è SnailyCAD (`snaily-cadv4-main/packages/config/src/socket-events.ts`):

**–í—ã–∑–æ–≤—ã –∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã:**
- `Create911Call` - —Å–æ–∑–¥–∞–Ω–∏–µ –≤—ã–∑–æ–≤–∞ 911
- `Update911Call` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–∑–æ–≤–∞ 911
- `End911Call` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤—ã–∑–æ–≤–∞ 911
- `CreateActiveIncident` - —Å–æ–∑–¥–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞
- `UpdateActiveIncident` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞
- `CreateActiveWarrant` - —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞
- `UpdateActiveWarrant` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞

**–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã:**
- `CreateTowCall` - –≤—ã–∑–æ–≤ —ç–≤–∞–∫—É–∞—Ç–æ—Ä–∞
- `UpdateTowCall` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–∑–æ–≤–∞ —ç–≤–∞–∫—É–∞—Ç–æ—Ä–∞
- `EndTowCall` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤—ã–∑–æ–≤–∞ —ç–≤–∞–∫—É–∞—Ç–æ—Ä–∞
- `CreateTaxiCall` - –≤—ã–∑–æ–≤ —Ç–∞–∫—Å–∏
- `UpdateTaxiCall` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–∑–æ–≤–∞ —Ç–∞–∫—Å–∏
- `EndTaxiCall` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤—ã–∑–æ–≤–∞ —Ç–∞–∫—Å–∏

**–°—Ç–∞—Ç—É—Å—ã —é–Ω–∏—Ç–æ–≤:**
- `UpdateOfficerStatus` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –æ—Ñ–∏—Ü–µ—Ä–æ–≤
- `UpdateEmsFdStatus` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ EMS/FD
- `UpdateUnitStatus` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —é–Ω–∏—Ç–∞
- `SetUnitOffDuty` - —Å–Ω—è—Ç–∏–µ —é–Ω–∏—Ç–∞ —Å –¥–µ–∂—É—Ä—Å—Ç–≤–∞

**BOLO –∏ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è:**
- `CreateBolo` - —Å–æ–∑–¥–∞–Ω–∏–µ BOLO
- `UpdateBolo` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ BOLO
- `DeleteBolo` - —É–¥–∞–ª–µ–Ω–∏–µ BOLO
- `Signal100` - —Å–∏–≥–Ω–∞–ª 100 (–∫–æ–¥ –º–æ–ª—á–∞–Ω–∏—è)
- `PANIC_BUTTON_ON` - –∞–∫—Ç–∏–≤–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ –ø–∞–Ω–∏–∫–∏
- `PANIC_BUTTON_OFF` - –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ –ø–∞–Ω–∏–∫–∏

**–°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è:**
- `UpdateAreaOfPlay` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–π –∑–æ–Ω—ã
- `RoleplayStopped` - –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–æ–ª–µ–≤–æ–π –∏–≥—Ä—ã
- `UpdateDispatchersState` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–æ–≤
- `UserBanned` - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `UserDeleted` - —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `Tones` - —Ç–æ–Ω–∞–ª—å–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã
- `PrivateMessage` - –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

### –ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–ª–∏—á–∏–π –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

#### 1. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

**–í—ã–∑–æ–≤—ã –∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã:**
```typescript
// –î–æ–±–∞–≤–∏—Ç—å –≤ –≤–∞—à WebSocket —Å–µ—Ä–≤–µ—Ä
- CALL_CREATED (–∞–Ω–∞–ª–æ–≥ Create911Call)
- CALL_UPDATED (–∞–Ω–∞–ª–æ–≥ Update911Call)
- CALL_ENDED (–∞–Ω–∞–ª–æ–≥ End911Call)
- INCIDENT_CREATED (–∞–Ω–∞–ª–æ–≥ CreateActiveIncident)
- INCIDENT_UPDATED (–∞–Ω–∞–ª–æ–≥ UpdateActiveIncident)
- WARRANT_CREATED (–∞–Ω–∞–ª–æ–≥ CreateActiveWarrant)
- WARRANT_UPDATED (–∞–Ω–∞–ª–æ–≥ UpdateActiveWarrant)
```

**–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã:**
```typescript
- TOW_CALL_CREATED
- TOW_CALL_UPDATED
- TOW_CALL_ENDED
- TAXI_CALL_CREATED
- TAXI_CALL_UPDATED
- TAXI_CALL_ENDED
```

**–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã —é–Ω–∏—Ç–æ–≤:**
```typescript
- UNIT_STATUS_UPDATED (—Ä–∞—Å—à–∏—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π unit_status_update)
- UNIT_OFF_DUTY
- OFFICER_STATUS_UPDATED
- EMS_FD_STATUS_UPDATED
```

**BOLO –∏ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è:**
```typescript
- BOLO_CREATED (—Ä–∞—Å—à–∏—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π bolo_alert)
- BOLO_UPDATED
- BOLO_DELETED
- SIGNAL_100_ON
- SIGNAL_100_OFF
- PANIC_BUTTON_ON (—Ä–∞—Å—à–∏—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π panic_alert)
- PANIC_BUTTON_OFF
```

#### 2. –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

**–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –∫–∞–Ω–∞–ª—ã –ø–æ–¥–ø–∏—Å–∫–∏:**
```typescript
- 'incidents' - —Å–æ–±—ã—Ç–∏—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤
- 'warrants' - —Å–æ–±—ã—Ç–∏—è –æ—Ä–¥–µ—Ä–æ–≤
- 'tow_calls' - –≤—ã–∑–æ–≤—ã —ç–≤–∞–∫—É–∞—Ç–æ—Ä–∞
- 'taxi_calls' - –≤—ã–∑–æ–≤—ã —Ç–∞–∫—Å–∏
- 'system' - —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- 'dispatchers' - —Å–æ–±—ã—Ç–∏—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–æ–≤
```

**–£–ª—É—á—à–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:**
```typescript
// –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ä–æ–ª–µ–π –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
interface CADClient {
  ws: WebSocket;
  userId?: number;
  departmentId?: number;
  isDispatcher?: boolean;
  isAdmin?: boolean;
  permissions: string[]; // ['view_calls', 'edit_calls', 'manage_units', etc.]
  subscriptions: string[];
}
```

#### 3. –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è WebSocket —Å–µ—Ä–≤–µ—Ä–∞

```typescript
// –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤
public broadcastIncidentCreated(incidentData: any) {
  this.broadcastEvent({
    type: 'incident_created',
    data: incidentData,
    timestamp: Date.now()
  }, ['incidents']);
}

public broadcastIncidentUpdated(incidentId: number, incidentData: any) {
  this.broadcastEvent({
    type: 'incident_updated',
    data: { incidentId, ...incidentData },
    timestamp: Date.now()
  }, ['incidents']);
}

// –ú–µ—Ç–æ–¥—ã –¥–ª—è –æ—Ä–¥–µ—Ä–æ–≤
public broadcastWarrantCreated(warrantData: any) {
  this.broadcastEvent({
    type: 'warrant_created',
    data: warrantData,
    timestamp: Date.now()
  }, ['warrants']);
}

// –ú–µ—Ç–æ–¥—ã –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
public broadcastTowCallCreated(towCallData: any) {
  this.broadcastEvent({
    type: 'tow_call_created',
    data: towCallData,
    timestamp: Date.now()
  }, ['tow_calls']);
}

// –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
public broadcastSignal100(value: boolean) {
  this.broadcastEvent({
    type: value ? 'signal_100_on' : 'signal_100_off',
    data: { value },
    timestamp: Date.now()
  }, ['system']);
}

public broadcastRoleplayStopped(value: boolean) {
  this.broadcastEvent({
    type: 'roleplay_stopped',
    data: { value },
    timestamp: Date.now()
  }, ['system']);
}

// –°–æ–±—ã—Ç–∏—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–æ–≤
public broadcastDispatcherUpdate(dispatcherData: any) {
  this.broadcastEvent({
    type: 'dispatcher_updated',
    data: dispatcherData,
    timestamp: Date.now()
  }, ['dispatchers']);
}
```

#### 4. –£–ª—É—á—à–µ–Ω–∏—è –≤ –ª–æ–≥–∏–∫–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π

```typescript
private shouldSendToClient(client: CADClient, eventType: string, channels: string[]): boolean {
  // –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –Ω–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω, –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏—è
  if (!client.userId) return false;

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞
  if (channels.length > 0) {
    return channels.some(channel => client.subscriptions.includes(channel));
  }

  // –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π
  switch (eventType) {
    // –°–æ–±—ã—Ç–∏—è —é–Ω–∏—Ç–æ–≤
    case 'unit_status_update':
    case 'unit_location_update':
    case 'unit_off_duty':
      return client.subscriptions.includes('units') || client.subscriptions.includes('all');
    
    // –°–æ–±—ã—Ç–∏—è –≤—ã–∑–æ–≤–æ–≤
    case 'new_call':
    case 'call_status_update':
    case 'call_created':
    case 'call_updated':
    case 'call_ended':
      return client.subscriptions.includes('calls') || client.subscriptions.includes('all');
    
    // –°–æ–±—ã—Ç–∏—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤
    case 'incident_created':
    case 'incident_updated':
      return client.subscriptions.includes('incidents') || client.subscriptions.includes('all');
    
    // –°–æ–±—ã—Ç–∏—è –æ—Ä–¥–µ—Ä–æ–≤
    case 'warrant_created':
    case 'warrant_updated':
      return client.subscriptions.includes('warrants') || client.subscriptions.includes('all');
    
    // –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã
    case 'tow_call_created':
    case 'tow_call_updated':
    case 'tow_call_ended':
      return client.subscriptions.includes('tow_calls') || client.subscriptions.includes('all');
    
    case 'taxi_call_created':
    case 'taxi_call_updated':
    case 'taxi_call_ended':
      return client.subscriptions.includes('taxi_calls') || client.subscriptions.includes('all');
    
    // –û–ø–æ–≤–µ—â–µ–Ω–∏—è
    case 'panic_alert':
    case 'bolo_alert':
    case 'signal_100_on':
    case 'signal_100_off':
      return client.subscriptions.includes('alerts') || client.subscriptions.includes('all');
    
    // –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
    case 'roleplay_stopped':
    case 'area_of_play_updated':
      return client.subscriptions.includes('system') || client.subscriptions.includes('all');
    
    // –°–æ–±—ã—Ç–∏—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–æ–≤
    case 'dispatcher_updated':
      return client.subscriptions.includes('dispatchers') || client.subscriptions.includes('all');
    
    default:
      return client.subscriptions.includes('all');
  }
}
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

#### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ):
1. `CALL_CREATED` / `CALL_UPDATED` / `CALL_ENDED`
2. `UNIT_STATUS_UPDATED` (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ)
3. `PANIC_BUTTON_ON` / `PANIC_BUTTON_OFF`
4. `BOLO_CREATED` / `BOLO_UPDATED` / `BOLO_DELETED`

#### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–≤–∞–∂–Ω–æ):
1. `INCIDENT_CREATED` / `INCIDENT_UPDATED`
2. `WARRANT_CREATED` / `WARRANT_UPDATED`
3. `SIGNAL_100_ON` / `SIGNAL_100_OFF`
4. `TOW_CALL_*` —Å–æ–±—ã—Ç–∏—è
5. `TAXI_CALL_*` —Å–æ–±—ã—Ç–∏—è

#### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ):
1. `ROLEPLAY_STOPPED`
2. `AREA_OF_PLAY_UPDATED`
3. `DISPATCHER_UPDATED`
4. `USER_BANNED` / `USER_DELETED`

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏

1. **–ü–æ—ç—Ç–∞–ø–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –ù–∞—á–Ω–∏—Ç–µ —Å —Å–æ–±—ã—Ç–∏–π –≤—ã—Å–æ–∫–æ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
2. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–æ–≤–æ–≥–æ —Å–æ–±—ã—Ç–∏—è
4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –û–±–Ω–æ–≤–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é API –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –î–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π

### –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è WebSocket –≤ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ –∏–º–µ–µ—Ç —Ö–æ—Ä–æ—à—É—é –æ—Å–Ω–æ–≤—É, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ SnailyCAD. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–æ—ç—Ç–∞–ø–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–µ–π –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π.

–û—Å–Ω–æ–≤–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è:
- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤—ã–∑–æ–≤–æ–≤ –∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤ –≤—ã–∑–æ–≤–æ–≤
- –£–ª—É—á—à–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —Å—Ç–∞—Ç—É—Å–æ–≤ —é–Ω–∏—Ç–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
- –£–ª—É—á—à–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

---

## –ò–¢–û–ì–û–í–û–ï –†–ï–ó–Æ–ú–ï –ò –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

1. **–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ WebSocket —Å–µ—Ä–≤–µ—Ä–∞** - –∏–∑—É—á–µ–Ω `server/websocket.ts`
2. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å SnailyCAD** - –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å–æ–±—ã—Ç–∏—è –∏–∑ `snaily-cadv4-main`
3. **–°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ WebSocket —Å–µ—Ä–≤–µ—Ä–∞** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Å–æ–±—ã—Ç–∏—è
4. **–°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Å—Ç–∞–Ω—Ç** - —Ñ–∞–π–ª `shared/websocket-events.ts`
5. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - —Å–æ–∑–¥–∞–Ω—ã –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### üîß –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

#### –ù–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è (28 —Å–æ–±—ã—Ç–∏–π):
- **–í—ã–∑–æ–≤—ã:** `CALL_CREATED`, `CALL_UPDATED`, `CALL_ENDED`
- **–ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã:** `INCIDENT_CREATED`, `INCIDENT_UPDATED`
- **–û—Ä–¥–µ—Ä–∞:** `WARRANT_CREATED`, `WARRANT_UPDATED`
- **–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã:** `TOW_CALL_*`, `TAXI_CALL_*` (6 —Å–æ–±—ã—Ç–∏–π)
- **–Æ–Ω–∏—Ç—ã:** `UNIT_OFF_DUTY`, `OFFICER_STATUS_UPDATED`, `EMS_FD_STATUS_UPDATED`
- **BOLO:** `BOLO_CREATED`, `BOLO_UPDATED`, `BOLO_DELETED`
- **–ü–∞–Ω–∏–∫–∞:** `PANIC_BUTTON_ON`, `PANIC_BUTTON_OFF`
- **–°–∏—Å—Ç–µ–º–∞:** `SIGNAL_100_ON/OFF`, `ROLEPLAY_STOPPED`, `AREA_OF_PLAY_UPDATED`
- **–î–∏—Å–ø–µ—Ç—á–µ—Ä—ã:** `DISPATCHER_UPDATED`

#### –ù–æ–≤—ã–µ –∫–∞–Ω–∞–ª—ã –ø–æ–¥–ø–∏—Å–∫–∏ (6 –∫–∞–Ω–∞–ª–æ–≤):
- `incidents`, `warrants`, `tow_calls`, `taxi_calls`, `system`, `dispatchers`

#### –°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (15 —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π):
- –ë–∞–∑–æ–≤—ã–µ: `VIEW_*` (5 —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π)
- –î–∏—Å–ø–µ—Ç—á–µ—Ä: `EDIT_*`, `MANAGE_*`, `CREATE_*` (9 —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π)
- –ê–¥–º–∏–Ω: `ADMIN_ACCESS`, `MANAGE_*` (4 —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è)

### üìã –ü–ª–∞–Ω –ø–æ—ç—Ç–∞–ø–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

#### –≠—Ç–∞–ø 1 (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ) - 1-2 –Ω–µ–¥–µ–ª–∏
1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ WebSocket —Å–µ—Ä–≤–µ—Ä–∞**
2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ API —Ä–æ—É—Ç—ã**
3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —á–∞—Å—Ç–∏ –¥–ª—è –Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π**
4. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π**

#### –≠—Ç–∞–ø 2 (–í–∞–∂–Ω–æ) - 2-3 –Ω–µ–¥–µ–ª–∏
1. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ (Tow/Taxi)**
2. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤**
3. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –æ—Ä–¥–µ—Ä–æ–≤**
4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π**

#### –≠—Ç–∞–ø 3 (–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ) - 1-2 –Ω–µ–¥–µ–ª–∏
1. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–æ–≤**
2. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è**
3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**

### üéØ –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å SnailyCAD** - –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
2. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
3. **–¢–∏–ø–∏–∑–∞—Ü–∏—è TypeScript** - –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–∏–ø–æ–≤
4. **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - —Å–∏—Å—Ç–µ–º–∞ –∫–∞–Ω–∞–ª–æ–≤ –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
6. **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** - –≥–æ—Ç–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–±—ã—Ç–∏—è

### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É–ª—É—á—à–µ–Ω–∏–π

- **–°–æ–±—ã—Ç–∏—è:** +28 –Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π (–±—ã–ª–æ 6, —Å—Ç–∞–ª–æ 34)
- **–ö–∞–Ω–∞–ª—ã:** +6 –Ω–æ–≤—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ (–±—ã–ª–æ 4, —Å—Ç–∞–ª–æ 10)
- **–†–∞–∑—Ä–µ—à–µ–Ω–∏—è:** +15 –Ω–æ–≤—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
- **–ú–µ—Ç–æ–¥—ã:** +25 –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –≤ WebSocket —Å–µ—Ä–≤–µ—Ä–µ
- **–¢–∏–ø–∏–∑–∞—Ü–∏—è:** 100% TypeScript –ø–æ–¥–¥–µ—Ä–∂–∫–∞

### üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π WebSocket —Å–µ—Ä–≤–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ –≤–∫–ª—é—á–∞–µ—Ç:

1. **–ì–æ—Ç–æ–≤—ã–π –∫–æ–¥** - –≤—Å–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã –∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
2. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
3. **–¢–∏–ø–∏–∑–∞—Ü–∏—è** - –ø–æ–ª–Ω–∞—è TypeScript –ø–æ–¥–¥–µ—Ä–∂–∫–∞
4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤
5. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –ø—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ API —Ä–æ—É—Ç—ã

### üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π WebSocket —Å–µ—Ä–≤–µ—Ä
2. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å** –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ API —Ä–æ—É—Ç—ã
3. **–û–±–Ω–æ–≤–∏—Ç—å** –∫–ª–∏–µ–Ω—Ç—Å–∫—É—é —á–∞—Å—Ç—å
4. **–î–æ–±–∞–≤–∏—Ç—å** –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
5. **–°–æ–∑–¥–∞—Ç—å** —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –∑–∞–¥–∞—á–∏ –∏ –ø—Ä–µ–≤–æ—Å—Ö–æ–¥–∏—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å SnailyCAD –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∞—Å–ø–µ–∫—Ç–∞—Ö –±–ª–∞–≥–æ–¥–∞—Ä—è —É–ª—É—á—à–µ–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∏ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏. 