# üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–µ–ø–ª–æ—è

## –û–±–∑–æ—Ä

–î–æ—Å—Ç—É–ø–Ω—ã –¥–≤–µ –≤–µ—Ä—Å–∏–∏ workflow –¥–ª—è –¥–µ–ø–ª–æ—è —Å —Ä–∞–∑–Ω—ã–º–∏ —É—Ä–æ–≤–Ω—è–º–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.

## üìÅ –î–æ—Å—Ç—É–ø–Ω—ã–µ workflow

### 1. `deploy.yml` - –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è
- ‚úÖ –í–∫–ª—é—á–∞–µ—Ç node_modules –≤ –∞—Ä—Ö–∏–≤
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π (–±–µ–∑ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –Ω–∞ VPS)
- ‚úÖ –ë–æ–ª—å—à–∏–π —Ä–∞–∑–º–µ—Ä –∞—Ä—Ö–∏–≤–∞

### 2. `deploy-optimized.yml` - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
- ‚úÖ –ò—Å–∫–ª—é—á–∞–µ—Ç node_modules –∏–∑ –∞—Ä—Ö–∏–≤–∞
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞ VPS
- ‚úÖ –ú–µ–Ω—å—à–∏–π —Ä–∞–∑–º–µ—Ä –∞—Ä—Ö–∏–≤–∞
- ‚úÖ –ë–æ–ª–µ–µ –≥–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

## üîß –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ª–∏—à–Ω–∏—Ö —Ñ–∞–π–ª–æ–≤

**–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è –≤–∫–ª—é—á–∞–µ—Ç:**
```
dist/           # –°–æ–±—Ä–∞–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
package.json    # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
package-lock.json
env.example     # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
scripts/        # –°–∫—Ä–∏–ø—Ç—ã
public/         # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
supabase/       # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Supabase
migrations/     # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
docs/           # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
README.md       # README
node_modules/   # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–≤–∫–ª—é—á–µ–Ω—ã)
```

**–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –≤–∫–ª—é—á–∞–µ—Ç:**
```
dist/           # –°–æ–±—Ä–∞–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
package.json    # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
package-lock.json
env.example     # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
scripts/        # –°–∫—Ä–∏–ø—Ç—ã
public/         # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
supabase/       # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Supabase
migrations/     # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
docs/           # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
README.md       # README
# node_modules/ –ù–ï –≤–∫–ª—é—á–µ–Ω—ã
```

### –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ä–µ—Å—Ç–∞—Ä—Ç PM2

**–°—Ç–∞—Ä—ã–π –ø–æ–¥—Ö–æ–¥:**
```bash
pm2 stop roleplayidentity
pm2 delete roleplayidentity
pm2 start dist/server.js --name roleplayidentity --env production
```

**–ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥:**
```bash
if pm2 list | grep -q "roleplayidentity"; then
  pm2 reload roleplayidentity  # –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ä–µ—Å—Ç–∞—Ä—Ç
else
  pm2 start dist/server.js --name roleplayidentity --env production
fi
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ—Ç downtime
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
- ‚úÖ –ú–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è:**
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ GitHub Actions
- –í–∫–ª—é—á–∞–µ—Ç node_modules –≤ –∞—Ä—Ö–∏–≤
- –ë—ã—Å—Ç—Ä–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –Ω–∞ VPS

**–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è:**
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ production –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞ VPS
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–ª–∞–≥–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
  ```bash
  npm ci --production --no-audit --no-fund
  ```

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è | –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è |
|---------|-------------|------------------|
| –†–∞–∑–º–µ—Ä –∞—Ä—Ö–∏–≤–∞ | ~50-100MB | ~10-20MB |
| –í—Ä–µ–º—è –ø–µ—Ä–µ–¥–∞—á–∏ | 30-60 —Å–µ–∫ | 5-15 —Å–µ–∫ |
| –í—Ä–µ–º—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞ VPS | 0 —Å–µ–∫ | 30-60 —Å–µ–∫ |
| –û–±—â–µ–µ –≤—Ä–µ–º—è –¥–µ–ø–ª–æ—è | 2-3 –º–∏–Ω | 2-3 –º–∏–Ω |
| –ì–∏–±–∫–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–∞—è |
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞ | –í—ã—Å–æ–∫–æ–µ | –ù–∏–∑–∫–æ–µ |

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤—ã–±–æ—Ä—É

### –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –≤–µ—Ä—Å–∏—é –µ—Å–ª–∏:
- ‚úÖ VPS –∏–º–µ–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–æ–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- ‚úÖ –•–æ—Ç–∏—Ç–µ –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞ VPS
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- ‚úÖ –ò–º–µ–µ—Ç–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ

### –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –µ—Å–ª–∏:
- ‚úÖ VPS –∏–º–µ–µ—Ç –±—ã—Å—Ç—Ä–æ–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- ‚úÖ –•–æ—Ç–∏—Ç–µ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
- ‚úÖ –ß–∞—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- ‚úÖ –ù—É–∂–Ω–∞ –≥–∏–±–∫–æ—Å—Ç—å –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

## üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏

### –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏:
```yaml
# –í .github/workflows/deploy.yml
name: Deploy to VPS
```

### –ê–∫—Ç–∏–≤–∞—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏:
```yaml
# –í .github/workflows/deploy-optimized.yml
name: Deploy to VPS (Optimized)
```

### –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤:
```bash
# –î–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏
mv .github/workflows/deploy.yml .github/workflows/deploy-standard.yml
mv .github/workflows/deploy-optimized.yml .github/workflows/deploy.yml
```

## üö® Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä –∞—Ä—Ö–∏–≤–∞
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä node_modules
du -sh node_modules/

# –ò—Å–∫–ª—é—á–∏—Ç–µ –Ω–µ–Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã
tar -czf test.tar.gz --exclude='node_modules/*' --exclude='.git/*' .
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ–¥–ª–µ–Ω–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫—ç—à npm
npm config set cache /path/to/cache

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ yarn –≤–º–µ—Å—Ç–æ npm
yarn install --production
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∏ –ø—Ä–∏ reload PM2
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ PM2
pm2 logs roleplayidentity

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ—Å—Ç–∞—Ä—Ç
pm2 restart roleplayidentity
```

## üìà –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –Ω–∞ VPS:
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –∫—ç—à–∞
mkdir -p ~/.npm-cache
npm config set cache ~/.npm-cache

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫—ç—à–∞ –≤ workflow
npm ci --production --cache ~/.npm-cache
```

### –°–∂–∞—Ç–∏–µ –∞—Ä—Ö–∏–≤–∞:
```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ pigz –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ —Å–∂–∞—Ç–∏—è
tar -I pigz -cf deployment.tar.gz dist/ package.json ...
```

### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞:
```yaml
# –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞—Ä—Ö–∏–≤–æ–≤
- name: Create core package
  run: tar -czf core.tar.gz dist/ package.json

- name: Create assets package  
  run: tar -czf assets.tar.gz public/ scripts/
```

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–û–±–µ –≤–µ—Ä—Å–∏–∏ workflow –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –Ω–∞–¥–µ–∂–Ω—ã–π –∏ –±—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π. –í—ã–±–æ—Ä –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–∞—à–∏—Ö –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤:

- **–°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ–¥–∞—á–∏** ‚Üí –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è
- **–≠–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞** ‚Üí –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
- **–ì–∏–±–∫–æ—Å—Ç—å** ‚Üí –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞** ‚Üí –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—á–∞—Ç—å —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –∏ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏. 