# Анализ несовместимых полей: RolePlayIdentity ↔ SnailyCAD

## Обзор

Данный документ содержит детальный анализ несовместимых полей между нашей системой RolePlayIdentity и SnailyCAD v4, включая рекомендации по их решению и приоритизацию.

## 1. Критически важные несовместимости

### 1.1 Отсутствующие поля в characters (Citizen)

#### 1.1.1 Демографические данные
| Поле SnailyCAD | Тип | Описание | Приоритет | Рекомендация |
|----------------|-----|----------|-----------|--------------|
| `gender` | Value | Пол | Высокий | Добавить enum Gender |
| `ethnicity` | Value | Этническая принадлежность | Средний | Добавить enum Ethnicity |
| `hairColor` | String | Цвет волос | Низкий | Добавить поле |
| `eyeColor` | String | Цвет глаз | Низкий | Добавить поле |
| `height` | String | Рост | Средний | Добавить поле |
| `weight` | String | Вес | Средний | Добавить поле |

#### 1.1.2 Контактная информация
| Поле SnailyCAD | Тип | Описание | Приоритет | Рекомендация |
|----------------|-----|----------|-----------|--------------|
| `phoneNumber` | String | Номер телефона | Высокий | Добавить поле |
| `postal` | String | Почтовый индекс | Средний | Добавить поле |

#### 1.1.3 Профессиональная информация
| Поле SnailyCAD | Тип | Описание | Приоритет | Рекомендация |
|----------------|-----|----------|-----------|--------------|
| `occupation` | String | Профессия | Средний | Добавить поле |
| `additionalInfo` | String | Дополнительная информация | Низкий | Добавить поле |

#### 1.1.4 Статусы
| Поле SnailyCAD | Тип | Описание | Приоритет | Рекомендация |
|----------------|-----|----------|-----------|--------------|
| `dead` | Boolean | Умер | Высокий | Добавить поле |
| `dateOfDead` | DateTime | Дата смерти | Высокий | Добавить поле |
| `missing` | Boolean | Пропал без вести | Высокий | Добавить поле |
| `dateOfMissing` | DateTime | Дата пропажи | Высокий | Добавить поле |
| `arrested` | Boolean | Арестован | Высокий | Добавить поле |

#### 1.1.5 Флаги и метаданные
| Поле SnailyCAD | Тип | Описание | Приоритет | Рекомендация |
|----------------|-----|----------|-----------|--------------|
| `flags` | Value[] | Флаги гражданина | Средний | Добавить JSON поле |
| `addressFlags` | Value[] | Флаги адреса | Низкий | Добавить JSON поле |
| `customFields` | CustomFieldValue[] | Кастомные поля | Средний | Добавить JSON поле |

### 1.2 Отсутствующие поля в users (User)

| Поле SnailyCAD | Тип | Описание | Приоритет | Рекомендация |
|----------------|-----|----------|-----------|--------------|
| `username` | String | Имя пользователя | Высокий | Добавить поле |
| `isDarkTheme` | Boolean | Темная тема | Низкий | Добавить поле |
| `soundSettings` | Json | Настройки звука | Низкий | Добавить JSON поле |
| `2FA` | Boolean | Двухфакторная аутентификация | Высокий | Добавить поле |

## 2. Специализированные несовместимости

### 2.1 Officer-specific поля

#### 2.1.1 Позывные и идентификация
| Поле SnailyCAD | Тип | Описание | Приоритет | Рекомендация |
|----------------|-----|----------|-----------|--------------|
| `callsign` | String | Основной позывной | Высокий | Добавить в characters |
| `callsign2` | String | Дополнительный позывной | Высокий | Добавить в characters |
| `activeDivisionCallsign` | IndividualDivisionCallsign | Активный позывной подразделения | Средний | Создать отдельную таблицу |
| `userDefinedCallsign` | String | Пользовательский позывной | Низкий | Добавить поле |

#### 2.1.2 Подразделения и должности
| Поле SnailyCAD | Тип | Описание | Приоритет | Рекомендация |
|----------------|-----|----------|-----------|--------------|
| `divisions` | DivisionValue[] | Подразделения | Высокий | Использовать существующую divisions |
| `position` | String | Должность | Средний | Добавить поле |
| `suspended` | Boolean | Приостановлен | Высокий | Добавить поле |

#### 2.1.3 Статусы и вайтлист
| Поле SnailyCAD | Тип | Описание | Приоритет | Рекомендация |
|----------------|-----|----------|-----------|--------------|
| `whitelistStatus` | LeoWhitelistStatus | Статус вайтлиста | Высокий | Создать enum |
| `radioChannelId` | String | Радиоканал | Средний | Добавить поле |

#### 2.1.4 Активные операции
| Поле SnailyCAD | Тип | Описание | Приоритет | Рекомендация |
|----------------|-----|----------|-----------|--------------|
| `activeIncident` | LeoIncident | Активный инцидент | Высокий | Создать связь |
| `activeCall` | Call911 | Активный вызов | Высокий | Создать связь |
| `activeVehicle` | EmergencyVehicleValue | Активное транспортное средство | Средний | Создать связь |

### 2.2 Vehicle-specific поля

| Поле SnailyCAD | Тип | Описание | Приоритет | Рекомендация |
|----------------|-----|----------|-----------|--------------|
| `insuranceStatus` | VehicleInspectionStatus | Статус страховки | Высокий | Добавить enum |
| `taxStatus` | VehicleTaxStatus | Налоговый статус | Высокий | Добавить enum |
| `inspectionStatus` | VehicleInspectionStatus | Статус техосмотра | Высокий | Добавить enum |
| `truckLicenseType` | String | Тип лицензии грузовика | Средний | Добавить поле |
| `truckLicenseMaxWeight` | Int | Максимальный вес | Средний | Добавить поле |
| `truckLicenseMaxWeightClass` | String | Класс веса | Средний | Добавить поле |

### 2.3 Weapon-specific поля

| Поле SnailyCAD | Тип | Описание | Приоритет | Рекомендация |
|----------------|-----|----------|-----------|--------------|
| `imageId` | String | Изображение оружия | Средний | Добавить поле |
| `notes` | String | Заметки | Низкий | Добавить поле |

## 3. Отсутствующие сущности

### 3.1 Бизнесы (критично)

**Проблема:** Полное отсутствие системы бизнесов в нашей системе.

**Требуемые сущности:**
- `Business` - основная сущность бизнеса
- `Employee` - сотрудники бизнеса
- `BusinessPost` - посты от бизнеса
- `EmployeeValue` - роли сотрудников

**Рекомендация:** Создать полную систему бизнесов с нуля.

### 3.2 Медицинские записи (высокий приоритет)

**Проблема:** Отсутствие системы медицинских записей.

**Требуемые сущности:**
- `MedicalRecord` - медицинские записи
- `DoctorVisit` - посещения врача

**Рекомендация:** Создать систему медицинских записей.

### 3.3 Система вызовов (высокий приоритет)

**Проблема:** Базовая реализация call911 без полной функциональности.

**Требуемые сущности:**
- `AssignedUnit` - назначенные юниты
- `Call911Event` - события вызовов
- `ActiveDispatchers` - активные диспетчеры

**Рекомендация:** Расширить существующую систему call911.

### 3.4 Система инцидентов (средний приоритет)

**Проблема:** Отсутствие системы инцидентов.

**Требуемые сущности:**
- `LeoIncident` - инциденты полиции
- `IncidentEvent` - события инцидентов
- `CombinedLeoUnit` - объединенные юниты

**Рекомендация:** Создать систему инцидентов.

### 3.5 Система записей (средний приоритет)

**Проблема:** Базовая реализация records без полной функциональности.

**Требуемые сущности:**
- `Warrant` - ордера на арест
- `Bolo` - бюллетени о розыске
- `RecordRelease` - освобождения из записей

**Рекомендация:** Расширить существующую систему records.

## 4. План реализации

### 4.1 Фаза 1: Критически важные поля (1-2 недели)

1. **Добавить демографические поля в characters:**
   - gender, ethnicity, height, weight
   - hairColor, eyeColor

2. **Добавить статусы в characters:**
   - dead, dateOfDead
   - missing, dateOfMissing
   - arrested

3. **Добавить контактную информацию:**
   - phoneNumber, postal

### 4.2 Фаза 2: Officer-specific поля (2-3 недели)

1. **Добавить позывные в characters:**
   - callsign, callsign2
   - userDefinedCallsign

2. **Добавить служебные поля:**
   - suspended, whitelistStatus
   - radioChannelId

3. **Создать систему подразделений:**
   - Использовать существующую divisions
   - Добавить связь с characters

### 4.3 Фаза 3: Новые сущности (3-4 недели)

1. **Создать систему бизнесов:**
   - Business, Employee, BusinessPost
   - EmployeeValue

2. **Создать медицинские записи:**
   - MedicalRecord, DoctorVisit

3. **Расширить систему вызовов:**
   - AssignedUnit, Call911Event
   - ActiveDispatchers

### 4.4 Фаза 4: Дополнительные системы (4-6 недель)

1. **Создать систему инцидентов:**
   - LeoIncident, IncidentEvent
   - CombinedLeoUnit

2. **Расширить систему записей:**
   - Warrant, Bolo
   - RecordRelease

3. **Добавить недостающие поля в vehicles/weapons:**
   - Статусы страховки, налогов
   - Изображения оружия

## 5. Технические рекомендации

### 5.1 Миграции базы данных

1. **Создать миграции для новых полей:**
   ```sql
   ALTER TABLE characters ADD COLUMN gender VARCHAR(50);
   ALTER TABLE characters ADD COLUMN ethnicity VARCHAR(50);
   -- и т.д.
   ```

2. **Создать новые таблицы:**
   ```sql
   CREATE TABLE businesses (
     id SERIAL PRIMARY KEY,
     -- поля бизнеса
   );
   ```

### 5.2 API изменения

1. **Обновить схемы валидации:**
   - Добавить новые поля в Zod схемы
   - Обновить типы TypeScript

2. **Обновить API endpoints:**
   - Добавить поддержку новых полей
   - Создать endpoints для новых сущностей

### 5.3 Frontend изменения

1. **Обновить формы:**
   - Добавить поля в формы создания/редактирования
   - Добавить валидацию новых полей

2. **Создать новые компоненты:**
   - Компоненты для бизнесов
   - Компоненты для медицинских записей

## 6. Заключение

Интеграция с SnailyCAD потребует значительных изменений в нашей системе, но обеспечит полноценную совместимость. Рекомендуется реализовывать изменения поэтапно, начиная с критически важных полей и заканчивая дополнительными системами.

Приоритет должен быть отдан:
1. Демографическим и статусным полям characters
2. Officer-specific полям
3. Системе бизнесов
4. Медицинским записям
5. Расширению системы вызовов 