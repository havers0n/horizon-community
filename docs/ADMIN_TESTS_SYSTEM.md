# Система административного управления тестами

## Обзор

Система административного управления тестами предоставляет полный функционал для создания, редактирования и проверки результатов тестов в приложении RolePlayIdentity.

## Функциональность

### 1. Управление тестами

#### Создание тестов
- **Доступ**: Только администраторы
- **Путь**: `/admin-tests` → Вкладка "Тесты" → "Создать тест"
- **Функции**:
  - Название и описание теста
  - Категория (вступление, медицина, пожарная служба, полиция)
  - Сложность (легкий, средний, сложный)
  - Длительность в минутах
  - Редактор вопросов с поддержкой:
    - Один правильный ответ
    - Несколько правильных ответов
    - Текстовый ответ
    - Настройка баллов за каждый вопрос

#### Редактирование тестов
- Изменение всех параметров существующего теста
- Редактирование вопросов и ответов
- Активация/деактивация тестов

#### Удаление тестов
- Проверка на активные сессии перед удалением
- Каскадное удаление результатов и сессий

### 2. Управление результатами

#### Просмотр результатов
- **Путь**: `/admin-tests` → Вкладка "Результаты"
- **Фильтрация**:
  - Все результаты
  - На проверке
  - Одобренные
  - Отклоненные

#### Детальный просмотр
- Полная информация о прохождении теста
- Ответы пользователя vs правильные ответы
- Время прохождения
- Количество нарушений (потеря фокуса, предупреждения)
- Статистика по каждому вопросу

#### Проверка результатов
- Одобрение/отклонение результатов
- Добавление комментариев администратора
- Автоматическое обновление статуса заявки при одобрении

### 3. Аналитика

#### Общая статистика
- Общее количество тестов
- Общее количество попыток
- Средняя проходимость

#### Статистика по тестам
- Количество попыток по каждому тесту
- Процент проходимости
- Средний балл
- Время прохождения

#### Временная аналитика
- Распределение попыток по часам дня
- Тренды активности

## API Endpoints

### Тесты

#### GET /api/admin/tests
Получение списка всех тестов с статистикой

**Ответ:**
```json
{
  "tests": [
    {
      "id": 1,
      "title": "LSPD Entry Exam",
      "description": "Базовый тест для вступления в полицейский департамент",
      "durationMinutes": 20,
      "questionsCount": 15,
      "category": "entry",
      "difficulty": "medium",
      "isActive": true,
      "totalAttempts": 45,
      "passRate": 78
    }
  ]
}
```

#### POST /api/admin/tests
Создание нового теста

**Тело запроса:**
```json
{
  "title": "Название теста",
  "description": "Описание теста",
  "category": "entry",
  "difficulty": "medium",
  "durationMinutes": 20,
  "questions": [
    {
      "id": "q_1",
      "question": "Текст вопроса",
      "type": "single",
      "options": ["Вариант 1", "Вариант 2", "Вариант 3"],
      "correctAnswer": "Вариант 1",
      "points": 1
    }
  ],
  "isActive": true
}
```

#### PUT /api/admin/tests/:id
Обновление теста

#### DELETE /api/admin/tests/:id
Удаление теста

### Результаты

#### GET /api/admin/tests/results
Получение результатов тестов с фильтрацией

**Параметры:**
- `status` - фильтр по статусу (all, pending, approved, rejected)
- `testId` - фильтр по ID теста

#### PUT /api/admin/tests/results/:id/status
Обновление статуса результата

**Тело запроса:**
```json
{
  "status": "approved",
  "comment": "Комментарий администратора"
}
```

### Аналитика

#### GET /api/admin/tests/analytics
Получение аналитики по тестам

**Ответ:**
```json
{
  "overview": {
    "totalTests": 5,
    "totalAttempts": 150,
    "totalPassed": 120,
    "passRate": 80
  },
  "testStats": [
    {
      "testId": 1,
      "title": "LSPD Entry Exam",
      "category": "entry",
      "difficulty": "medium",
      "totalAttempts": 45,
      "passedAttempts": 35,
      "passRate": 78,
      "avgScore": 82,
      "avgTime": 1200
    }
  ],
  "timeStats": [
    {
      "hour": 10,
      "attempts": 25
    }
  ]
}
```

## Компоненты

### TestQuestionEditor
Компонент для создания и редактирования вопросов теста.

**Функции:**
- Добавление/удаление вопросов
- Настройка типов вопросов
- Управление вариантами ответов
- Установка правильных ответов
- Настройка баллов

### TestResultDetails
Компонент для детального просмотра результатов теста.

**Функции:**
- Отображение основной информации
- Показ ответов пользователя
- Сравнение с правильными ответами
- Административные действия
- Комментарии

## Безопасность

### Авторизация
- Все административные функции требуют роль `admin`
- Проверка JWT токена для всех запросов
- Middleware `requireAdmin` для защиты роутов

### Валидация
- Схемы валидации с помощью Zod
- Проверка обязательных полей
- Валидация типов вопросов и ответов
- Проверка корректности данных

### Защита от ошибок
- Проверка существования тестов перед обновлением
- Проверка активных сессий перед удалением
- Обработка ошибок с информативными сообщениями

## Интеграция

### С системой заявок
- Автоматическое обновление статуса заявки при одобрении теста
- Связь результатов тестов с заявками на вступление

### С системой уведомлений
- Уведомления о новых результатах тестов
- Уведомления об изменении статуса

### С системой логирования
- Логирование всех административных действий
- Аудит изменений тестов и результатов

## Использование

### Для администраторов

1. **Создание теста:**
   - Перейти в `/admin-tests`
   - Нажать "Создать тест"
   - Заполнить основную информацию
   - Добавить вопросы через редактор
   - Сохранить тест

2. **Проверка результатов:**
   - Перейти на вкладку "Результаты"
   - Фильтровать по статусу при необходимости
   - Нажать на кнопку "Глаз" для детального просмотра
   - Одобрить или отклонить результат
   - Добавить комментарий при необходимости

3. **Анализ статистики:**
   - Перейти на вкладку "Аналитика"
   - Изучить общую статистику
   - Анализировать эффективность тестов
   - Выявлять проблемные области

### Для разработчиков

1. **Добавление новых типов вопросов:**
   - Расширить схему валидации
   - Обновить компонент TestQuestionEditor
   - Добавить логику обработки в API

2. **Интеграция с другими системами:**
   - Использовать хуки для обновления связанных данных
   - Добавить новые поля в схемы
   - Расширить аналитику

## Мониторинг

### Метрики для отслеживания
- Количество созданных тестов
- Количество попыток прохождения
- Средняя проходимость
- Время проверки результатов
- Количество отклоненных результатов

### Алерты
- Новые результаты на проверке
- Низкая проходимость тестов
- Долгое время проверки

## Планы развития

### Краткосрочные
- [ ] Экспорт результатов в Excel
- [ ] Массовые операции с результатами
- [ ] Шаблоны тестов

### Среднесрочные
- [ ] Автоматическая проверка текстовых ответов
- [ ] Система рейтингов вопросов
- [ ] Адаптивные тесты

### Долгосрочные
- [ ] ИИ для анализа ответов
- [ ] Интеграция с внешними системами тестирования
- [ ] Мобильное приложение для проверки 