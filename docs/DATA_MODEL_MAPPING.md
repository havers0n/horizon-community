# Анализ маппинга моделей данных: RolePlayIdentity ↔ SnailyCAD

## Обзор

Данный документ содержит детальный анализ соответствия моделей данных между нашей системой RolePlayIdentity и SnailyCAD v4, включая прямые соответствия, несовместимые поля и дублирующиеся сущности.

## 1. Основные сущности - Прямые соответствия

### 1.1 Пользователи (Users)
| Наша система | SnailyCAD | Соответствие | Примечания |
|-------------|-----------|--------------|------------|
| `users` | `User` | ✅ Полное | Обе системы имеют базовые поля: id, email, passwordHash |
| - `id` | - `id` | ✅ | |
| - `email` | - `email` | ✅ | |
| - `passwordHash` | - `password` | ✅ | |
| - `siteRole` | - `role` | ✅ | |
| - `discordId` | - `discordId` | ✅ | |
| - `apiToken` | - `apiToken` | ✅ | |

**Несовместимые поля SnailyCAD:**
- `username` - отсутствует в нашей системе
- `isDarkTheme` - настройки темы
- `soundSettings` - настройки звука
- `2FA` - двухфакторная аутентификация

### 1.2 Персонажи (Characters/Citizens)
| Наша система | SnailyCAD | Соответствие | Примечания |
|-------------|-----------|--------------|------------|
| `characters` | `Citizen` | ✅ Частичное | Основные поля совпадают |
| - `id` | - `id` | ✅ | |
| - `ownerId` | - `userId` | ✅ | |
| - `firstName` | - `name` | ✅ | |
| - `lastName` | - `surname` | ✅ | |
| - `dob` | - `dateOfBirth` | ✅ | |
| - `address` | - `address` | ✅ | |
| - `insuranceNumber` | - `socialSecurityNumber` | ✅ | |
| - `licenses` | - `driversLicense`, `weaponLicense`, etc. | ✅ | Структурированные лицензии |
| - `medicalInfo` | - `MedicalRecord[]` | ✅ | |
| - `mugshotUrl` | - `imageId` | ✅ | |

**Несовместимые поля SnailyCAD:**
- `gender` - отсутствует в нашей системе
- `ethnicity` - отсутствует в нашей системе  
- `hairColor`, `eyeColor` - отсутствуют
- `height`, `weight` - отсутствуют
- `postal` - почтовый индекс
- `phoneNumber` - отсутствует
- `occupation` - отсутствует
- `additionalInfo` - отсутствует
- `flags` - флаги гражданина
- `dead`, `missing`, `arrested` - статусы

**Несовместимые поля нашей системы:**
- `type` (civilian, leo, fire, ems) - отсутствует в SnailyCAD
- `departmentId`, `rankId`, `divisionId` - карьерная информация
- `badgeNumber`, `employeeId` - служебная информация
- `hireDate`, `terminationDate` - даты приема/увольнения

### 1.3 Департаменты (Departments)
| Наша система | SnailyCAD | Соответствие | Примечания |
|-------------|-----------|--------------|------------|
| `departments` | `DepartmentValue` | ✅ Частичное | Концептуально схожи |
| - `id` | - `id` | ✅ | |
| - `name` | - `value.value` | ✅ | Через связь с Value |
| - `type` | - `type` | ✅ | LEO, EMS, FIRE, etc. |

**Несовместимые поля SnailyCAD:**
- `callsign` - позывной департамента
- `customTemplate` - кастомный шаблон
- `whitelisted` - вайтлист
- `isDefaultDepartment` - дефолтный департамент
- `isConfidential` - конфиденциальность
- `extraFields` - дополнительные поля

## 2. Специализированные сущности

### 2.1 Офицеры (Officers)
| Наша система | SnailyCAD | Соответствие | Примечания |
|-------------|-----------|--------------|------------|
| `characters` (type: 'leo') | `Officer` | ✅ Частичное | Наша система объединяет в characters |
| - `departmentId` | - `departmentId` | ✅ | |
| - `rankId` | - `rankId` | ✅ | |
| - `badgeNumber` | - `badgeNumber` | ✅ | |
| - `status` | - `statusId` | ✅ | |

**Несовместимые поля SnailyCAD:**
- `callsign`, `callsign2` - позывные
- `activeDivisionCallsign` - активный позывной подразделения
- `divisions` - подразделения
- `position` - должность
- `suspended` - приостановлен
- `imageId` - фото
- `citizenId` - связь с гражданином
- `whitelistStatus` - статус вайтлиста
- `radioChannelId` - радиоканал
- `activeIncident`, `activeCall` - активные инциденты/вызовы

### 2.2 Бизнесы (Businesses)
| Наша система | SnailyCAD | Соответствие | Примечания |
|-------------|-----------|--------------|------------|
| ❌ Отсутствует | `Business` | ❌ Нет соответствия | Требует создания новой сущности |
| - | - `id` | ❌ | |
| - | - `userId` | ❌ | |
| - | - `name` | ❌ | |
| - | - `address` | ❌ | |
| - | - `whitelisted` | ❌ | |
| - | - `status` | ❌ | |

**Рекомендация:** Создать новую сущность `businesses` в нашей системе.

### 2.3 Транспортные средства (Vehicles)
| Наша система | SnailyCAD | Соответствие | Примечания |
|-------------|-----------|--------------|------------|
| `vehicles` | `RegisteredVehicle` | ✅ Частичное | |
| - `id` | - `id` | ✅ | |
| - `ownerId` | - `citizenId` | ✅ | |
| - `plate` | - `plate` | ✅ | |
| - `vin` | - `vin` | ✅ | |
| - `model` | - `modelId` | ✅ | Через связь с VehicleValue |
| - `color` | - `color` | ✅ | |
| - `registration` | - `registrationStatus` | ✅ | |

**Несовместимые поля SnailyCAD:**
- `insuranceStatus` - статус страховки
- `taxStatus` - налоговый статус
- `inspectionStatus` - статус техосмотра
- `truckLicenseType` - тип лицензии грузовика
- `truckLicenseMaxWeight` - максимальный вес
- `truckLicenseMaxWeightClass` - класс веса
- `truckLicenseMaxTrailerWeight` - вес прицепа
- `truckLicenseMaxTrailerWeightClass` - класс веса прицепа

### 2.4 Оружие (Weapons)
| Наша система | SnailyCAD | Соответствие | Примечания |
|-------------|-----------|--------------|------------|
| `weapons` | `Weapon` | ✅ Частичное | |
| - `id` | - `id` | ✅ | |
| - `ownerId` | - `citizenId` | ✅ | |
| - `serialNumber` | - `serialNumber` | ✅ | |
| - `model` | - `modelId` | ✅ | Через связь с WeaponValue |
| - `registration` | - `registrationStatus` | ✅ | |

**Несовместимые поля SnailyCAD:**
- `imageId` - изображение оружия
- `notes` - заметки

## 3. Дублирующиеся сущности

### 3.1 Департаменты
**Проблема:** Обе системы имеют собственные модели департаментов.

**Наша система:** `departments` (простая структура)
**SnailyCAD:** `DepartmentValue` (сложная структура через Value)

**Рекомендация:** 
- Сохранить нашу простую структуру
- Добавить недостающие поля из SnailyCAD при необходимости

### 3.2 Звания и ранги
**Проблема:** Разные подходы к управлению званиями.

**Наша система:** `ranks` (отдельная таблица)
**SnailyCAD:** `Value` (универсальная система значений)

**Рекомендация:**
- Сохранить нашу структуру как более специализированную
- Добавить связь с департаментами

### 3.3 Лицензии
**Проблема:** Разные подходы к хранению лицензий.

**Наша система:** `licenses` (JSON поле)
**SnailyCAD:** Отдельные поля для каждого типа лицензии

**Рекомендация:**
- Сохранить нашу гибкую JSON структуру
- Добавить валидацию типов лицензий

## 4. Отсутствующие сущности в нашей системе

### 4.1 Бизнесы
- `Business` - полная система управления бизнесами
- `Employee` - сотрудники бизнесов
- `BusinessPost` - посты от бизнесов

### 4.2 Медицинские записи
- `MedicalRecord` - медицинские записи
- `DoctorVisit` - посещения врача

### 4.3 Система вызовов
- `Call911` - вызовы экстренных служб
- `AssignedUnit` - назначенные юниты
- `Call911Event` - события вызовов

### 4.4 Система инцидентов
- `LeoIncident` - инциденты полиции
- `IncidentEvent` - события инцидентов
- `CombinedLeoUnit` - объединенные юниты

### 4.5 Система записей
- `Record` - записи о правонарушениях
- `Warrant` - ордера на арест
- `Bolo` - бюллетени о розыске

## 5. Рекомендации по интеграции

### 5.1 Приоритетные задачи
1. **Создать сущность Business** - критично для полноценной интеграции
2. **Добавить недостающие поля в characters** - gender, ethnicity, height, weight
3. **Реализовать систему вызовов** - Call911 и связанные сущности
4. **Добавить медицинские записи** - MedicalRecord, DoctorVisit

### 5.2 Миграция данных
1. **Создать скрипты миграции** для переноса данных из SnailyCAD
2. **Реализовать валидацию** для обеспечения целостности данных
3. **Добавить индексы** для оптимизации производительности

### 5.3 API совместимость
1. **Изучить API SnailyCAD** для понимания форматов данных
2. **Создать адаптеры** для преобразования форматов
3. **Реализовать webhook'и** для синхронизации в реальном времени

## 6. Заключение

Наша система имеет хорошую основу для интеграции с SnailyCAD, но требует доработки в следующих областях:

1. **Расширение модели characters** для поддержки всех полей SnailyCAD
2. **Создание новых сущностей** (Business, MedicalRecord, etc.)
3. **Унификация подходов** к управлению департаментами и званиями
4. **Реализация недостающего функционала** (вызовы, инциденты, записи)

Интеграция потребует значительных усилий, но обеспечит полноценную совместимость с экосистемой SnailyCAD. 