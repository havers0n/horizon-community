# Быстрое исправление миграции форума

## Проблемы
1. Ошибка `42846: cannot cast type uuid to integer` в миграции форума
2. Ошибка `23503: insert or update on table "forum_categories" violates foreign key constraint`

## Решение

### 1. Исправлена миграция
✅ Файл `supabase/migrations/013_forum_system.sql` исправлен:
- Заменено `auth.uid()::integer` на правильную связь через `auth_id`
- Исправлены RLS политики для корректной работы с UUID

### 2. Исправлено создание категорий
✅ Файл `scripts/create_forum_tables.sql` обновлен:
- Категории создаются на основе существующих департаментов
- Если департаменты не найдены, создаются категории без привязки
- Добавлены проверки существования департаментов

### 3. Создан файл для проверки департаментов
✅ Файл `scripts/check_departments.sql` для проверки существующих департаментов

### 4. Инструкции по применению
✅ Файл `FORUM_MIGRATION_INSTRUCTIONS.md` с подробными инструкциями

## Что нужно сделать

### Вариант 1: Через Supabase Dashboard (Рекомендуется)
1. Откройте https://supabase.com/dashboard
2. Выберите ваш проект
3. Перейдите в SQL Editor
4. **Сначала выполните** `scripts/check_departments.sql` для проверки департаментов
5. **Затем выполните** `scripts/create_forum_tables.sql` для создания форума

### Вариант 2: Через команду
```bash
npm run forum:setup
```

## Проверка
После применения миграции:
1. Перезапустите сервер: `npm run dev`
2. Откройте http://localhost:5173/forum
3. Убедитесь, что категории отображаются

## Готово!
Форум будет полностью функционален после применения миграции. Категории будут созданы на основе существующих департаментов или без привязки, если департаменты не найдены. 